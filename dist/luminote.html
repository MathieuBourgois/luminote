<!doctype html><html lang="en"><head><meta charset="UTF-8"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/><title>Luminote</title></head><body><app-root></app-root><script>(()=>{var e={991:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i(81),r=i.n(n),s=i(645),o=i.n(s)()(r());o.push([e.id,':root{--primary-color: hsl(244deg 57% 54%);--primary-color--lighter: hsl(244deg 70% 63%);--primary-color--darker: hsl(244deg 48% 40%);--link-color: hsl(244deg 100% 77%);--tag-text-color: hsl(244deg 100% 91%);--tag-bg-color: hsl(244deg 100% 78% / 23%);--tag-text-color--success: hsl(190deg 100% 91% / 1);--tag-bg-color--success: hsl(190deg 100% 78% / 23%)}*,*::before,*::after{box-sizing:border-box}:root{font-size:62.5%}body{font-family:sans-serif;font-size:1.4rem;line-height:1.5em;background:#000;color:rgba(255,255,255,.6);position:relative;margin:0;height:100dvh;overflow:hidden}a{color:var(--link-color);border-radius:.2rem}h1,h2,h3,h4,h5,h6,strong{color:rgba(255,255,255,.8666666667)}summary{cursor:pointer}:root{--form-border-radius: 1rem }:not(.comboInput)>:focus-visible,.comboInput:has(:focus-visible){outline:.2rem solid var(--link-color);outline-offset:.2rem}.input,.button{display:inline-flex;align-items:center;padding:1rem 2rem;min-height:4rem;border:none;border-radius:var(--form-border-radius);text-decoration:none;outline:none}.input{background-color:#fff;color:#444}.input:-webkit-autofill,.input:-webkit-autofill:hover,.input:-webkit-autofill:focus{box-shadow:0 0 0 10vw #fff inset}.button{background-color:var(--primary-color);color:#fff;justify-content:center;text-transform:uppercase;cursor:pointer;text-align:center}.button:hover,.button:focus-visible{background-color:var(--primary-color--lighter)}.comboInput,.inputGroup{display:flex;border-radius:var(--form-border-radius)}.comboInput :first-of-type,.inputGroup :first-of-type{border-top-right-radius:0;border-bottom-right-radius:0}.comboInput :not(:first-child):not(:last-child),.inputGroup :not(:first-child):not(:last-child){border-radius:0}.comboInput :last-child,.inputGroup :last-child{border-top-left-radius:0;border-bottom-left-radius:0}.tag{display:inline-flex;gap:1px;border-radius:1rem;overflow:hidden}.tag>*{background:var(--tag-bg-color);color:var(--tag-text-color);padding:.2rem 1rem}.tag.-success>*{background:var(--tag-bg-color--success);color:var(--tag-text-color--success)}.relative{position:relative}.text-center{text-align:center}.grow{flex-grow:1}.shrink-0{flex-shrink:0}.mb-1{margin-bottom:1rem}app-root{height:100%;display:flex;flex-direction:column}.app_overlay{position:absolute;left:1rem;top:1rem;width:min(100% - 2rem,48rem);max-height:calc(100% - 2rem);border-radius:1rem;backdrop-filter:blur(5rem);overflow:auto;z-index:1}.app_remoteStripForm{position:relative}.app_remoteStripForm .input[type=text]{flex-grow:1}.app_remoteStripForm_connexionIndicator{flex-shrink:0;width:3rem;justify-content:flex-end;padding:0}.app_remoteStripForm_connexionIndicator::before{content:"";display:block;width:1rem;height:1rem;background-color:#aaa;border-radius:1rem}.app_remoteStripForm_connexionIndicator.-online::before{background-color:#be0d3a}',""]);const a=o},36:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i(81),r=i.n(n),s=i(645),o=i.n(s)()(r());o.push([e.id,"app-piano-keyboard{--default-pianoKeyboard_stripColor: #9f3f55;--default-pianoKeyboard_whiteKeyColor: #fff;--default-pianoKeyboard_whiteKeyColor--pressed: rgb(164, 211, 238);--default-pianoKeyboard_whiteKeyColor--sustained: rgb(231 185 102);--default-pianoKeyboard_blackKeyColor: #2b2b2b;--default-pianoKeyboard_blackKeyColor--pressed: rgb(62, 137, 187);--default-pianoKeyboard_blackKeyColor--sustained: rgb(187 137 62);position:relative;display:flex;border-top:.3vw solid var(--pianoKeyboard_stripColor, var(--default-pianoKeyboard_stripColor));user-select:none;transition:filter 1s}app-piano-keyboard.-no-strip{border:none}app-piano-keyboard[data-disabled]{filter:brightness(0.5)}app-piano-keyboard .pianoKeyboard_blackKeys{position:absolute;inset:0;bottom:33%;display:flex;pointer-events:none}app-piano-keyboard .pianoKeyboard_blackKeys>*{flex-grow:1}app-piano-keyboard .pianoKeyboard_key{flex-grow:1;border:none;padding:0;cursor:pointer;pointer-events:auto;transition:background-color 150ms}app-piano-keyboard .pianoKeyboard_key:focus-within{outline-offset:-2px;outline-width:-4px}app-piano-keyboard .pianoKeyboard_key.-white{aspect-ratio:1/6;background:var(--pianoKeyboard_whiteKeyColor, var(--default-pianoKeyboard_whiteKeyColor))}app-piano-keyboard .pianoKeyboard_key.-white.-sustained{background:var(--pianoKeyboard_whiteKeyColor--pressed, var(--default-pianoKeyboard_whiteKeyColor--pressed))}app-piano-keyboard .pianoKeyboard_key.-white.-pressed{background:var(--pianoKeyboard_whiteKeyColor--sustained, var(--default-pianoKeyboard_whiteKeyColor--sustained))}app-piano-keyboard .pianoKeyboard_key.-black{border-radius:0 0 .3vw .3vw;background:var(--pianoKeyboard_blackKeyColor, var(--default-pianoKeyboard_blackKeyColor))}app-piano-keyboard .pianoKeyboard_key.-black.-sustained{background:var(--pianoKeyboard_blackKeyColor--pressed, var(--default-pianoKeyboard_blackKeyColor--pressed))}app-piano-keyboard .pianoKeyboard_key.-black.-pressed{background:var(--pianoKeyboard_blackKeyColor--sustained, var(--default-pianoKeyboard_blackKeyColor--sustained))}",""]);const a=o},645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i="",n=void 0!==t[5];return t[4]&&(i+="@supports (".concat(t[4],") {")),t[2]&&(i+="@media ".concat(t[2]," {")),n&&(i+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),i+=e(t),n&&(i+="}"),t[2]&&(i+="}"),t[4]&&(i+="}"),i})).join("")},t.i=function(e,i,n,r,s){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(n)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(o[l]=!0)}for(var h=0;h<e.length;h++){var c=[].concat(e[h]);n&&o[c[0]]||(void 0!==s&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=s),i&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=i):c[2]=i),r&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=r):c[4]="".concat(r)),t.push(c))}},t}},81:e=>{"use strict";e.exports=function(e){return e[1]}},908:(e,t,i)=>{var n;n="undefined"!=typeof window?window:void 0!==i.g?i.g:"undefined"!=typeof self?self:{},e.exports=n},376:e=>{e.exports=function(e){if(!e)return!1;var i=t.call(e);return"[object Function]"===i||"function"==typeof e&&"[object RegExp]"!==i||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)};var t=Object.prototype.toString},947:e=>{var t=function(e){return e.replace(/^\s+|\s+$/g,"")};e.exports=function(e){if(!e)return{};for(var i,n={},r=t(e).split("\n"),s=0;s<r.length;s++){var o=r[s],a=o.indexOf(":"),l=t(o.slice(0,a)).toLowerCase(),h=t(o.slice(a+1));void 0===n[l]?n[l]=h:(i=n[l],"[object Array]"===Object.prototype.toString.call(i)?n[l].push(h):n[l]=[n[l],h])}return n}},379:e=>{"use strict";var t=[];function i(e){for(var i=-1,n=0;n<t.length;n++)if(t[n].identifier===e){i=n;break}return i}function n(e,n){for(var s={},o=[],a=0;a<e.length;a++){var l=e[a],h=n.base?l[0]+n.base:l[0],c=s[h]||0,u="".concat(h," ").concat(c);s[h]=c+1;var d=i(u),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==d)t[d].references++,t[d].updater(p);else{var f=r(p,n);n.byIndex=a,t.splice(a,0,{identifier:u,updater:f,references:1})}o.push(u)}return o}function r(e,t){var i=t.domAPI(t);return i.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;i.update(e=t)}else i.remove()}}e.exports=function(e,r){var s=n(e=e||[],r=r||{});return function(e){e=e||[];for(var o=0;o<s.length;o++){var a=i(s[o]);t[a].references--}for(var l=n(e,r),h=0;h<s.length;h++){var c=i(s[h]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}s=l}}},569:e=>{"use strict";var t={};e.exports=function(e,i){var n=function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(i)}},216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},565:(e,t,i)=>{"use strict";e.exports=function(e){var t=i.nc;t&&e.setAttribute("nonce",t)}},795:e=>{"use strict";e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(i){!function(e,t,i){var n="";i.supports&&(n+="@supports (".concat(i.supports,") {")),i.media&&(n+="@media ".concat(i.media," {"));var r=void 0!==i.layer;r&&(n+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),n+=i.css,r&&(n+="}"),i.media&&(n+="}"),i.supports&&(n+="}");var s=i.sourceMap;s&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,i)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},875:(e,t,i)=>{"use strict";var n=i(908),r=i(376),s=i(947),o=i(529);function a(e,t,i){var n=e;return r(t)?(i=t,"string"==typeof e&&(n={uri:e})):n=o(t,{uri:e}),n.callback=i,n}function l(e,t,i){return h(t=a(e,t,i))}function h(e){if(void 0===e.callback)throw new Error("callback argument missing");var t=!1,i=function(i,n,r){t||(t=!0,e.callback(i,n,r))};function n(){var e=void 0;if(e=c.response?c.response:c.responseText||function(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch(e){}return null}(c),v)try{e=JSON.parse(e)}catch(e){}return e}function r(e){return clearTimeout(u),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,i(e,y)}function o(){if(!h){var t;clearTimeout(u),t=e.useXDR&&void 0===c.status?200:1223===c.status?204:c.status;var r=y,o=null;return 0!==t?(r={body:n(),statusCode:t,method:p,headers:{},url:d,rawRequest:c},c.getAllResponseHeaders&&(r.headers=s(c.getAllResponseHeaders()))):o=new Error("Internal XMLHttpRequest Error"),i(o,r,r.body)}}var a,h,c=e.xhr||null;c||(c=e.cors||e.useXDR?new l.XDomainRequest:new l.XMLHttpRequest);var u,d=c.url=e.uri||e.url,p=c.method=e.method||"GET",f=e.body||e.data,g=c.headers=e.headers||{},m=!!e.sync,v=!1,y={body:void 0,headers:{},statusCode:0,method:p,url:d,rawRequest:c};if("json"in e&&!1!==e.json&&(v=!0,g.accept||g.Accept||(g.Accept="application/json"),"GET"!==p&&"HEAD"!==p&&(g["content-type"]||g["Content-Type"]||(g["Content-Type"]="application/json"),f=JSON.stringify(!0===e.json?f:e.json))),c.onreadystatechange=function(){4===c.readyState&&setTimeout(o,0)},c.onload=o,c.onerror=r,c.onprogress=function(){},c.onabort=function(){h=!0},c.ontimeout=r,c.open(p,d,!m,e.username,e.password),m||(c.withCredentials=!!e.withCredentials),!m&&e.timeout>0&&(u=setTimeout((function(){if(!h){h=!0,c.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",r(e)}}),e.timeout)),c.setRequestHeader)for(a in g)g.hasOwnProperty(a)&&c.setRequestHeader(a,g[a]);else if(e.headers&&!function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(c.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(c),c.send(f||null),c}e.exports=l,e.exports.default=l,l.XMLHttpRequest=n.XMLHttpRequest||function(){},l.XDomainRequest="withCredentials"in new l.XMLHttpRequest?l.XMLHttpRequest:n.XDomainRequest,function(e,t){for(var i=0;i<e.length;i++)t(e[i])}(["get","put","post","patch","head","delete"],(function(e){l["delete"===e?"del":e]=function(t,i,n){return(i=a(t,i,n)).method=e.toUpperCase(),h(i)}}))},529:e=>{e.exports=function(){for(var e={},i=0;i<arguments.length;i++){var n=arguments[i];for(var r in n)t.call(n,r)&&(e[r]=n[r])}return e};var t=Object.prototype.hasOwnProperty}},t={};function i(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={id:n,exports:{}};return e[n](s,s.exports,i),s.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.nc=void 0,(()=>{"use strict";var e=i(379),t=i.n(e),n=i(795),r=i.n(n),s=i(569),o=i.n(s),a=i(565),l=i.n(a),h=i(216),c=i.n(h),u=i(589),d=i.n(u),p=i(991),f={};f.styleTagTransform=d(),f.setAttributes=l(),f.insert=o().bind(null,"head"),f.domAPI=r(),f.insertStyleElement=c(),t()(p.Z,f),p.Z&&p.Z.locals&&p.Z.locals;let g=0;const m="templateCallbacks";function v(e){return g++,window[m][g]=e,`${m}[${g}](event)`}function y(e,t){return e.reduce(((e,i,n)=>e+t(i,n)),"")}window[m]=[];class E{constructor(e,t){this.strip=e,this.notes=t,this.init()}init(){this.onInit&&this.onInit()}tick(){this.onTick()}}class b{constructor(e,t=4,i=0,n=0,r=0,s=0){this.isDirty=!1,this._stripLength=e,this._colorPerPixel=t,this._floatRawData=new Float32Array(this._stripLength*this._colorPerPixel),this._intRawData=new Uint8Array(this._stripLength*this._colorPerPixel),this.fill(i,n,r,s)}get length(){return this._stripLength}getColorPerPixel(){return this._colorPerPixel}set(e,t,i,n,r=0){const s=this._floatRawData[e*this._colorPerPixel],o=this._floatRawData[e*this._colorPerPixel+1],a=this._floatRawData[e*this._colorPerPixel+2];let l=0;4===this._colorPerPixel&&(l=this._floatRawData[e*this._colorPerPixel+3]),Math.round(1e4*t)===Math.round(1e4*s)&&Math.round(1e4*i)===Math.round(1e4*o)&&Math.round(1e4*n)===Math.round(1e4*a)&&Math.round(1e4*r)===Math.round(1e4*l)||(this._floatRawData[e*this._colorPerPixel]=t,this._floatRawData[e*this._colorPerPixel+1]=i,this._floatRawData[e*this._colorPerPixel+2]=n,this._intRawData[e*this._colorPerPixel]=Math.floor(256*t),this._intRawData[e*this._colorPerPixel+1]=Math.floor(256*i),this._intRawData[e*this._colorPerPixel+2]=Math.floor(256*n),4===this._colorPerPixel&&(this._floatRawData[e*this._colorPerPixel+3]=r,this._intRawData[e*this._colorPerPixel+3]=Math.floor(256*r)),this.isDirty=!0)}get(e){const t={r:this._floatRawData[e*this._colorPerPixel],g:this._floatRawData[e*this._colorPerPixel+1],b:this._floatRawData[e*this._colorPerPixel+2]};return 4===this._colorPerPixel&&(t.w=this._floatRawData[e*this._colorPerPixel+3]),t}getInt(e){const t={r:this._intRawData[e*this._colorPerPixel],g:this._intRawData[e*this._colorPerPixel+1],b:this._intRawData[e*this._colorPerPixel+2]};return 4===this._colorPerPixel&&(t.w=this._intRawData[e*this._colorPerPixel+3]),t}fill(e,t,i,n=0){for(let t=0;t<this._stripLength;t++)this.set(t,e,i,i,n)}getIntRawData(){return this._intRawData}forEach(e){for(let t=0,i=this.length;t<i;t++)e(t)}copyTo(e,t=0){for(let i=t;i<this.length;i++)if(i>=0&&i<e.length){const n=i-t,r=this.get(i);e.set(n,r.r,r.g,r.b,r.w)}}}class _{static getName(e){return _.MIDI_TO_NAME[e%12]}static getMidiNote(e){let[,t,i]=/^([a-gA-G]#?)(-?\d)$/.exec(e)||[];return _.NAME_TO_MIDI[t.toUpperCase()]+12*(Number(i)+_.octaveOffset)}static getOctave(e){return Math.floor(e/12)-_.octaveOffset}static getFrequency(e,t="A3",i=440){return Math.pow(2,(e-_.getMidiNote(t))/12)*i}static getPreviousMidiNoteByName(e,t){let i=t;do{i--}while(_.getName(i)!==e);return i}static getNextMidiNoteByName(e,t){let i=t;do{i++}while(_.getName(i)!==e);return i}}_.MIDI_TO_NAME=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],_.NAME_TO_MIDI={C:0,"C#":1,D:2,"D#":3,E:4,F:5,"F#":6,G:7,"G#":8,A:9,"A#":10,B:11},_.octaveOffset=2;const T={pianoKeyboard:{lowestKey:_.getMidiNote("A-1"),highestKey:_.getMidiNote("C7")},remoteStrip:{host:"",startPointNote:_.getMidiNote("A-1")},stripBehavior:{list:{Simple:class extends E{onTick(){this.strip.forEach((e=>{if(this.notes[e].pressed)this.strip.set(e,0,0,0,this.notes[e].velocity),this.notes[e].velocity*=.99;else if(this.notes[e].sustained)this.strip.set(e,.15*this.notes[e].velocity,.3*this.notes[e].velocity,.3*this.notes[e].velocity,0),this.notes[e].velocity*=.99;else{const t=this.strip.get(e);this.strip.set(e,.8*t.r,.8*t.g,.8*t.b,.8*t.w)}}))}},Ripples:class extends E{onInit(){this.stripBuffer=new b(this.strip.length,this.strip.getColorPerPixel())}onTick(){this.stripBuffer.forEach((e=>{const t=this.strip.get(e);let i,n;e>0&&(i=this.strip.get(e-1)),e<this.stripBuffer.length-1&&(n=this.strip.get(e+1));const r={r:((i?i.r:0)+t.r+(n?n.r:0))/(1+(i?1:0)+(n?1:0)),g:((i?i.g:0)+t.g+(n?n.g:0))/(1+(i?1:0)+(n?1:0)),b:((i?i.b:0)+t.b+(n?n.b:0))/(1+(i?1:0)+(n?1:0)),w:((i?i.w:0)+t.w+(n?n.w:0))/(1+(i?1:0)+(n?1:0))};this.stripBuffer.set(e,r.r,r.g,r.b,r.w)})),this.strip.forEach((e=>{const t=this.stripBuffer.get(e);this.notes[e].pressed?(this.strip.set(e,t.r,t.g,t.b,t.w+.2*this.notes[e].velocity),this.notes[e].velocity*=.99):this.notes[e].sustained?(this.strip.set(e,t.r+.15*this.notes[e].velocity*.2,t.g+.3*this.notes[e].velocity*.2,t.b+.3*this.notes[e].velocity*.2,.95*t.w),this.notes[e].velocity*=.99):this.strip.set(e,.95*t.r,.95*t.g,.95*t.b,.95*t.w)}))}},Octaves:class extends E{onTick(){this.strip.forEach((e=>{this.notes[e].pressed||this.notes[e].sustained||this.strip.set(e,0,0,0,0)})),this.strip.forEach((e=>{(this.notes[e].pressed||this.notes[e].sustained)&&this.strip.forEach((t=>{e!==t&&e%12==t%12&&this.strip.set(t,.02,.04,.04,0)}))})),this.strip.forEach((e=>{this.notes[e].pressed?this.strip.set(e,0,0,0,.6):this.notes[e].sustained&&this.strip.set(e,.2,.4,.4,0)}))}}},current:localStorage.stripBehavior||"Ripples"},viewportRenderer:{list:{Skylines:"app-line-strip-renderer","Slide up":"app-slide-up-strip-renderer"},current:localStorage.viewportRenderer||"Skylines"}};class w{constructor(e){this._value=e,this._callbacks=[]}get value(){return this._value}set value(e){this._value=e,this.notifyChange()}notifyChange(){this._callbacks.forEach((e=>e(this.value)))}onChange(e,t=!0){this._callbacks.push(e),t&&void 0!==this.value&&e(this.value)}}class R extends w{constructor(e,t){super(t),this.localStorageKeyName=e,this.localStorageKeyName in localStorage&&this.loadFromLocalStorage(),this.onChange((()=>this.saveToLocalStorage()))}loadFromLocalStorage(){this.value=JSON.parse(localStorage.getItem(this.localStorageKeyName))}saveToLocalStorage(){localStorage.setItem(this.localStorageKeyName,JSON.stringify(this.value))}}const x={strip:{remoteHost:new R("remoteStripHost",T.remoteStrip.host),isRemoteConnected:new w(!1),behavior:new R("stripBehavior",T.stripBehavior.current)},viewportRenderer:new R("viewportRenderer",T.viewportRenderer.current),midi:{ports:{input:new w([]),output:new w([])}}};class S{constructor(){S.count++,this._ref=S.count}toString(){return this.token}get token(){return`data-element-ref="${this.ref}"`}get ref(){return this._ref}get element(){return this._element||(this._element=document.querySelector(`[${this.token}]`)),this._element}}S.count=0;class P extends HTMLElement{constructor(){super(...arguments),this.elementRefs={remoteStripConnexionIndicator:new S,remoteStripHostInput:new S,midi:{count:new S,ports:{input:new S,output:new S}}}}connectedCallback(){this.initView(),x.strip.isRemoteConnected.onChange((e=>{e?this.elementRefs.remoteStripConnexionIndicator.element.classList.add("-online"):this.elementRefs.remoteStripConnexionIndicator.element.classList.remove("-online")})),["input","output"].forEach((e=>{x.midi.ports[e].onChange((t=>{const i=this.elementRefs.midi.ports[e].element;i.innerHTML="",t.forEach((e=>{const t=document.createElement("li");t.innerText=e,i.appendChild(t)}));const n=x.midi.ports.input.value.length,r=x.midi.ports.output.value.length;this.elementRefs.midi.count.element.innerHTML=`\n          <span class="tag ${n?"-success":""}">\n            <span>inputs</span> <span>${n}</span>\n          </span>\n          \n          <span class="tag ${r?"-success":""}">\n            <span>outputs</span> <span>${r}</span>\n          </span>\n        `}))}))}initView(){this.innerHTML=`\n      <style>\n        ${this.tagName} {\n          display: flex;\n          flex-direction: column;\n          gap: .2rem;\n        }\n        \n        .app-configPanel_section {\n          padding: 2rem;\n          background-color: #2f323db3;\n      \n          :first-child { margin-top: 0; }\n          :last-child { margin-bottom: 0; }\n        }\n      </style>\n      \n      <section class="app-configPanel_section">\n        <h2>Strip behavior</h2>\n        <select class="input" onchange="${v((e=>this.selectStripBehavior(e)))}">\n          ${y(Object.keys(T.stripBehavior.list),(e=>`\n            <option value="${e}" ${e===x.strip.behavior.value?"selected":""}>\n              ${e}\n            </option>\n          `))}\n        </select>\n      </section>\n      \n      <section class="app-configPanel_section">\n        <h2>Viewport</h2>\n        <select class="input" onchange="${v((e=>this.selectViewportRenderer(e)))}">\n          ${y(Object.keys(T.viewportRenderer.list),(e=>`\n            <option value="${e}" ${e===x.viewportRenderer.value?"selected":""}>\n              ${e}\n            </option>\n          `))}\n        </select>\n      </section>\n    \n      <section class="app-configPanel_section">\n        <h2>Remote strip</h2>\n        <form class="app_remoteStripForm comboInput mb-1" onsubmit="${v((e=>this.onConnectToRemoteStrip(e)))}">\n          <div ${this.elementRefs.remoteStripConnexionIndicator} class="app_remoteStripForm_connexionIndicator input"></div>\n          <input\n            ${this.elementRefs.remoteStripHostInput}\n            type="text"\n            class="input"\n            size="1"\n            placeholder="Type the IP of the remote strip"\n            value="${x.strip.remoteHost.value}"\n          />\n          <input type="submit" value="Connect" class="button"/>\n        </form>\n      \n        <details>\n          <summary>How this works ?</summary>\n          <h3>Purpose</h3>\n          <p>\n            Allows <strong>Luminote</strong> to control a <strong>LED strip (WS2812)</strong>, connected to an <strong>ESP32</strong>, via the <strong>Wi-Fi network</strong>.\n          </p>\n          \n          <h3>How to use it</h3>\n          <h4>LED strip</h4>\n          <ol>\n            <li class="mb-1">\n              <strong>Install the <a href="https://github.com/Yori-Mirano/websocket-esp32-remote-led-strip">websocket-esp32-remote-led-strip</a> program</strong>\n              to an <strong>ESP32</strong> (follow the README instructions)\n            </li>\n            \n            <li class="mb-1">\n              <strong>Plug</strong> a <strong>LED strip (WS2812)</strong> to the <strong>ESP32</strong>\n            </li>\n            \n            <li class="mb-1">\n              <strong>Turn it on</strong>\n            </li>\n          </ol>\n            \n          <h4>Luminote</h4>\n          <ol>\n            <li class="mb-1">\n              <a class="button" href="${window.location.href}" download>Download Luminote</a>\n            </li>\n            \n            <li class="mb-1">\n              Open it <strong>locally</strong>\n            </li>\n            \n            <li class="mb-1">\n              <strong>Type the IP</strong> of the LED strip, and <strong>connect</strong>\n            </li>\n            \n            <li class="mb-1">\n              <strong>Play piano to see the LED strip react</strong><br/>\n              (with your MIDI device, or by clicking any key on the virtual piano keyboard)\n            </li>\n          </ol>\n          \n          <h3>Why locally ?</h3>\n          <p>\n            Luminote connects to the LED strip via the <code>ws://</code> protocol because the ESP32 does not have the capacity to\n            support the encrypted one (<code>wss://</code>).\n          </p>\n          <p>\n            However, browsers, for security reasons, prevents the use of such a\n            connection from a site hosted on a server.\n          </p>\n        </details>\n      </section>\n      \n      <details class="app-configPanel_section">\n        <summary>\n          Currently used MIDI devices\n          <span ${this.elementRefs.midi.count}></span>\n        </summary>\n        \n        <h3>Inputs</h3>\n        <ul ${this.elementRefs.midi.ports.input}></ul>\n        \n        <h3>Outputs</h3>\n        <ul ${this.elementRefs.midi.ports.output}></ul>\n      </details>\n      \n      <section class="app-configPanel_section text-center">\n        <p>\n          by Yori Mirano | <a href="https://github.com/Yori-Mirano/luminote">Github</a>\n        </p>\n      </section>\n    `}onConnectToRemoteStrip(e){e.preventDefault(),x.strip.remoteHost.value=this.elementRefs.remoteStripHostInput.element.value}selectStripBehavior(e){x.strip.behavior.value=e.target.value}selectViewportRenderer(e){x.viewportRenderer.value=e.target.value}}P.tagName="app-config-panel",customElements.define(P.tagName,P);class C extends HTMLElement{constructor(){super(...arguments),this.mouseover=!1,this.hasFocus=!1}connectedCallback(){this.initStyle(),this.initEventListeners(),this.startAutoHidingDelay()}initStyle(){const e=document.createElement("style");e.innerHTML=`\n      @keyframes app-auto-hide--fade-in {\n        from { opacity: 0.1; transform: translateX(-5vw); }\n        to   { opacity: 1; transform: translateX(0); }\n      }\n      \n      @keyframes app-auto-hide--fade-out {\n        from { opacity: 1; transform: translateX(0); }\n        to   { opacity: 0; transform: translateX(-5vw); }\n      }\n      \n      ${this.tagName}:not([data-hidden]) {\n        animation: app-auto-hide--fade-in 120ms forwards cubic-bezier(0, 0, 0.2, 1);\n      }\n\n      ${this.tagName}[data-hidden] {\n        animation: app-auto-hide--fade-out 300ms forwards cubic-bezier(0.4, 0, 1, 1);\n      }\n    `,this.prepend(e)}initEventListeners(){this.parentElement.addEventListener("mousemove",(()=>{this.show(),this.startAutoHidingDelay()})),this.addEventListener("focusin",(()=>{this.hasFocus=!0,this.cancelAutoHidingDelay(),this.show()})),this.addEventListener("focusout",(()=>{this.hasFocus=!1,this.startAutoHidingDelay()})),this.addEventListener("mouseenter",(()=>{this.mouseover=!0,this.cancelAutoHidingDelay()})),this.addEventListener("mouseleave",(()=>{this.mouseover=!1,this.startAutoHidingDelay()}))}startAutoHidingDelay(){this.mouseover||this.hasFocus||(this.cancelAutoHidingDelay(),this.timeout=setTimeout((()=>this.hide()),parseInt(this.dataset.delay)))}cancelAutoHidingDelay(){this.timeout&&clearTimeout(this.timeout)}hide(){this.dataset.hidden=""}show(){delete this.dataset.hidden}}C.tagName="app-auto-hide",customElements.define(C.tagName,C);var L=i(36),N={};N.styleTagTransform=d(),N.setAttributes=l(),N.insert=o().bind(null,"head"),N.domAPI=r(),N.insertStyleElement=c(),t()(L.Z,N),L.Z&&L.Z.locals&&L.Z.locals;class A extends HTMLElement{constructor(){super(...arguments),this.sustainThreshold=43,this.sustainLevel=0,this.keys={},this.isKeyOn=!1,this.onKeyboardKeyDown=()=>{this.isKeyOn=!0},this.onKeyboardKeyUp=()=>{this.isKeyOn=!1}}static isBlackKey(e){return-1!==_.getName(e).indexOf("#")}static isWhiteKey(e){return!A.isBlackKey(e)}static getMouseVerticalPositionFromTarget(e,t){const i=t.getBoundingClientRect();return(e.clientY-i.top)/t.offsetHeight}connectedCallback(){var e,t,i,n;null!==(e=(i=this.dataset).lowestKey)&&void 0!==e||(i.lowestKey="A1"),null!==(t=(n=this.dataset).highestKey)&&void 0!==t||(n.highestKey="C9"),this.init()}disconnectedCallback(){this.destroy()}attributeChangedCallback(e,t,i){t===i||"data-lowest-key"!==e&&"data-highest-key"!==e||this.init()}updateNoteRangeFromElementDataset(){this.lowestNote=this.getMidiNote(this.dataset.lowestKey),this.highestNote=this.getMidiNote(this.dataset.highestKey)}getMidiNote(e){return/^\d+$/.test(e)?parseInt(e):_.getMidiNote(e)}get totalKeys(){return this.highestNote-this.lowestNote+1}init(){this.destroy(),this.updateNoteRangeFromElementDataset(),this.addEventListener("pointerdown",this.onKeyboardKeyDown),document.addEventListener("pointerup",this.onKeyboardKeyUp);const e=document.createElement("div");e.classList.add("pianoKeyboard_blackKeys"),e.style.left=this.leftMargin+"%",e.style.right=this.rightMargin+"%",this.appendChild(e);for(let t=this.lowestNote;t<=this.highestNote;t++){const i=document.createElement("button");if(i.classList.add("pianoKeyboard_key"),this.initKeyEventListeners(i,t),this.keys[t]=i,A.isWhiteKey(t)){i.classList.add("-white"),this.appendChild(i);const n=document.createElement("div");this.initKeyEventListeners(n,t),e.appendChild(n)}else i.classList.add("-black"),e.appendChild(i)}}initKeyEventListeners(e,t){e.addEventListener("pointerdown",(i=>{this.triggerKeyPress(t,this.getVelocityFromPosition(i,e))})),["pointerup","blur"].forEach((i=>e.addEventListener(i,(()=>{this.triggerKeyRelease(t)})))),e.addEventListener("keydown",(e=>{["Enter","Space"].includes(e.code)&&this.triggerKeyPress(t,127)})),e.addEventListener("keyup",(e=>{["Enter","Space"].includes(e.code)&&this.triggerKeyRelease(t)})),e.addEventListener("pointerenter",(i=>{this.isKeyOn&&this.triggerKeyPress(t,this.getVelocityFromPosition(i,e))})),e.addEventListener("pointerleave",(()=>{this.isKeyOn&&this.triggerKeyRelease(t)}))}getVelocityFromPosition(e,t){return Math.round(127*A.getMouseVerticalPositionFromTarget(e,t))}disable(){this.dataset.disabled=""}enable(){delete this.dataset.disabled}get leftMargin(){const e=_.getPreviousMidiNoteByName("C",this.lowestNote);return(this.lowestNote-e)*this.blackKeyWidthPercent-this.getWhiteKeyCount(e,this.lowestNote-1)*this.whiteKeyWidthPercent}get rightMargin(){const e=_.getNextMidiNoteByName("B",this.highestNote);return(e-this.highestNote)*this.blackKeyWidthPercent-this.getWhiteKeyCount(this.highestNote+1,e)*this.whiteKeyWidthPercent}get whiteKeyWidthPercent(){return 100/this.getWhiteKeyCount()}get blackKeyWidthPercent(){return 7*this.whiteKeyWidthPercent/12}pressKey(e){this.keys[e]&&(this.keys[e].classList.add("-pressed"),this.isSustained()&&this.keys[e].classList.add("-sustained"))}releaseKey(e){this.keys[e]&&this.keys[e].classList.remove("-pressed")}setSustain(e){this.sustainLevel=e,this.isSustained()?this.querySelectorAll(".-pressed").forEach((e=>{e.classList.add("-sustained")})):this.querySelectorAll(".-sustained").forEach((e=>{e.classList.remove("-sustained")}))}isSustained(){return this.sustainLevel>this.sustainThreshold}getWhiteKeyCount(e=this.lowestNote,t=this.highestNote){let i=0;for(let n=e;n<=t;n++)A.isWhiteKey(n)&&i++;return i}getBlackKeyCount(e=this.lowestNote,t=this.highestNote){let i=0;for(let n=e;n<=t;n++)A.isBlackKey(n)&&i++;return i}getKeyCount(){return this.highestNote-this.lowestNote+1}triggerKeyPress(e,t){const i={detail:{note:e,velocity:t}};this.dispatchEvent(new CustomEvent(A.ON_KEY_PRESSED,i))}triggerKeyRelease(e){const t={detail:{note:e}};this.dispatchEvent(new CustomEvent(A.ON_KEY_RELEASED,t))}releaseExternalListeners(){document.removeEventListener("pointerup",this.onKeyboardKeyUp)}destroy(){this.innerHTML="",this.releaseExternalListeners()}}A.ON_KEY_PRESSED="key_pressed",A.ON_KEY_RELEASED="key_released",A.observedAttributes=["data-lowest-key","data-highest-key"],customElements.define("app-piano-keyboard",A);class k extends HTMLElement{constructor(){super(...arguments),this.factor=1}get strip(){return this._strip}set strip(e){this._strip=e,this.init()}connectedCallback(){this._initStyle(),this._initCanvas(),requestAnimationFrame((()=>this._resize())),window.addEventListener("resize",(()=>{this._resize()}))}_initStyle(){const e=document.createElement("style");e.innerHTML=`\n      ${this.tagName} {\n        position: relative;\n      }\n\n      ${this.tagName} > canvas {\n        position: absolute;\n        inset: 0;\n        width: 100%;\n      }\n    `,this.appendChild(e)}_initCanvas(){this.canvas=document.createElement("canvas"),this.appendChild(this.canvas)}_resize(){this.canvas.height=this.clientHeight,this.canvas.width=this.clientWidth}init(){this.strip&&this.onInit()}render(){this.strip&&this.onRender()}}class D extends k{onInit(){this.context=this.canvas.getContext("2d")}}customElements.define("app-line-strip-renderer",class extends D{onRender(){const e=this.canvas.width/this.strip.length,t=this.canvas.height;this.strip.forEach((i=>{const n=this.strip.get(i),r=Math.min(255,(255*n.r+255*n.w*.5)*this.factor),s=Math.min(255,(255*n.g+255*n.w*.5)*this.factor),o=Math.min(255,(255*n.b+255*n.w*.35)*this.factor);this.context.fillStyle=`rgb(${r}, ${s}, ${o})`,this.context.fillRect(e*i,this.canvas.height-t,e,t)}))}});var M=i(875),I=i.n(M),O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},K=(function(){function e(e){this.value=e}function t(t){var i,n;function r(i,n){try{var o=t[i](n),a=o.value;a instanceof e?Promise.resolve(a.value).then((function(e){r("next",e)}),(function(e){r("throw",e)})):s(o.done?"return":"normal",o.value)}catch(e){s("throw",e)}}function s(e,t){switch(e){case"return":i.resolve({value:t,done:!0});break;case"throw":i.reject(t);break;default:i.resolve({value:t,done:!1})}(i=i.next)?r(i.key,i.arg):n=null}this._invoke=function(e,t){return new Promise((function(s,o){var a={key:e,arg:t,resolve:s,reject:o,next:null};n?n=n.next=a:(i=n=a,r(e,t))}))},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),F=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),U=function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)},X="",H='\n\tThis page requires a browser that supports WebGL.<br/>\n\t<a href="http://get.webgl.org">Click here to upgrade your browser.</a>\n',B='\n\tIt does not appear your computer can support WebGL.<br/>\n\t<a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>\n',G=1,W=2;function $(e,t,i,n){var r=e.gl,s=r.createShader(i);return r.shaderSource(s,t),r.compileShader(s),r.getShaderParameter(s,r.COMPILE_STATUS)?s:(X=r.getShaderInfoLog(s),console.error("*** Error compiling shader "+s+":"+X),e.trigger("error",{shader:s,source:t,type:i,error:X,offset:n||0}),r.deleteShader(s),null)}function V(e,t,i,n){for(var r=e.gl,s=r.createProgram(),o=0;o<t.length;++o)r.attachShader(s,t[o]);if(i)for(var a=0;a<i.length;++a)r.bindAttribLocation(s,n?n[a]:a,i[a]);return r.linkProgram(s),r.getProgramParameter(s,r.LINK_STATUS)?s:(X=r.getProgramInfoLog(s),console.log("Error in program linking:"+X),r.deleteProgram(s),null)}function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=[];for(var n in e){var r=e[n],s=void 0;if(t&&(n=t+"."+n),"number"==typeof r)i.push({type:"float",method:"1f",name:n,value:r});else if(Array.isArray(r)){if("number"==typeof r[0])1===r.length?i.push({type:"float",method:"1f",name:n,value:r}):r.length>=2&&r.length<=4?i.push({type:"vec"+r.length,method:r.length+"fv",name:n,value:r}):r.length>4&&i.push({type:"float[]",method:"1fv",name:n+"[0]",value:r});else if("string"==typeof r[0])i.push({type:"sampler2D",method:"1i",name:n,value:r});else if(Array.isArray(r[0])&&"number"==typeof r[0][0]){if(r[0].length>=2&&r[0].length<=4)for(s=0;s<r.length;s++)i.push({type:"vec"+r[0].length,method:r[s].length+"fv",name:n+"["+s+"]",value:r[s]})}else if("object"===O(r[0]))for(s=0;s<r.length;s++)i.push.apply(i,U(j(r[s],n+"["+s+"]")))}else"boolean"==typeof r?i.push({type:"bool",method:"1i",name:n,value:r}):"string"==typeof r?i.push({type:"sampler2D",method:"1i",name:n,value:r}):"object"===(void 0===r?"undefined":O(r))&&i.push.apply(i,U(j(r,n)))}return i}function q(e){return 0==(e&e-1)}function z(e){var t=new Set;return Object.assign(e,{on:function(e,i){var n={};n[e]=i,t.add(n)},off:function(e,i){if(i){var n={};n[e]=i,t.delete(n)}else{var r=!0,s=!1,o=void 0;try{for(var a,l=t[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var h=a.value,c=!0,u=!1,d=void 0;try{for(var p,f=Object.keys(h)[Symbol.iterator]();!(c=(p=f.next()).done);c=!0)if(p.value===e)return void t.delete(h)}catch(e){u=!0,d=e}finally{try{!c&&f.return&&f.return()}finally{if(u)throw d}}}}catch(e){s=!0,o=e}finally{try{!r&&l.return&&l.return()}finally{if(s)throw o}}}},listSubscriptions:function(){var e=!0,i=!1,n=void 0;try{for(var r,s=t[Symbol.iterator]();!(e=(r=s.next()).done);e=!0){var o=r.value;console.log(o)}}catch(e){i=!0,n=e}finally{try{!e&&s.return&&s.return()}finally{if(i)throw n}}},subscribe:function(e){t.add(e)},unsubscribe:function(e){t.delete(e)},unsubscribeAll:function(){t.clear()},trigger:function(e){for(var i=arguments.length,n=Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];var s=!0,o=!1,a=void 0;try{for(var l,h=t[Symbol.iterator]();!(s=(l=h.next()).done);s=!0){var c=l.value;"function"==typeof c[e]&&c[e].apply(c,U(n))}}catch(e){o=!0,a=e}finally{try{!s&&h.return&&h.return()}finally{if(o)throw a}}}})}var Y=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};K(this,e),z(this),this.gl=t,this.texture=t.createTexture(),this.texture&&(this.valid=!0),this.bind(),this.name=i,this.source=null,this.sourceType=null,this.loading=null,this.setData(1,1,new Uint8Array([0,0,0,255]),{filtering:"linear"}),this.setFiltering(n.filtering),this.load(n)}return F(e,[{key:"destroy",value:function(){this.valid&&(this.gl.deleteTexture(this.texture),this.texture=null,delete this.data,this.data=null,this.valid=!1)}},{key:"bind",value:function(t){this.valid&&("number"==typeof t&&e.activeUnit!==t&&(this.gl.activeTexture(this.gl.TEXTURE0+t),e.activeUnit=t),e.activeTexture!==this.texture&&(this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),e.activeTexture=this.texture))}},{key:"load",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.loading=null,"string"==typeof e.url?void 0!==this.url&&e.url===this.url||this.setUrl(e.url,e):e.element?this.setElement(e.element,e):e.data&&e.width&&e.height&&this.setData(e.width,e.height,e.data,e)}},{key:"setUrl",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.valid)return this.url=e,this.source=this.url,this.sourceType="url",this.loading=new Promise((function(n,r){var s=e.split(".").pop().toLowerCase(),o="ogv"===s||"webm"===s||"mp4"===s,a=void 0;o?((a=document.createElement("video")).autoplay=!0,a.muted=!0,setTimeout((function(){a.play()}),1),i.filtering="nearest"):a=new Image,a.onload=function(){try{t.setElement(a,i)}catch(e){console.log("Texture '"+t.name+"': failed to load url: '"+t.source+"'",e,i)}n(t)},a.onerror=function(e){console.log("Texture '"+t.name+"': failed to load url: '"+t.source+"'",e,i),n(t)},/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&"data:"===t.source.slice(0,5)||(a.crossOrigin="anonymous"),a.src=t.source,o&&t.setElement(a,i)})),this.loading}},{key:"setData",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.width=e,this.height=t,this.source=i,this.sourceType="data",this.update(n),this.setFiltering(n),this.loading=Promise.resolve(this),this.loading}},{key:"setElement",value:function(e,t){var i=this,n=e;if("string"==typeof e&&(e=document.querySelector(e)),e instanceof HTMLCanvasElement||e instanceof HTMLImageElement||e instanceof HTMLVideoElement)this.source=e,this.sourceType="element",e instanceof HTMLVideoElement?(this.width=this.source.videoWidth,this.height=this.source.videoHeight,e.addEventListener("canplaythrough",(function(){i.intervalID=setInterval((function(){i.update(t)}),15)}),!0),e.addEventListener("ended",(function(){e.currentTime=0,e.play()}),!0)):this.update(t),this.setFiltering(t);else{var r="the 'element' parameter (`element: "+JSON.stringify(n)+"`) must be a CSS ";r+="selector string, or a <canvas>, <image> or <video> object",console.log("Texture '"+this.name+"': "+r,t)}return this.loading=Promise.resolve(this),this.loading}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.valid&&(this.bind(),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1!==e.UNPACK_FLIP_Y_WEBGL),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.UNPACK_PREMULTIPLY_ALPHA_WEBGL||!1),"element"===this.sourceType&&(this.source instanceof HTMLCanvasElement||this.source instanceof HTMLVideoElement||this.source instanceof HTMLImageElement&&this.source.complete)?(this.source instanceof HTMLVideoElement?(this.width=this.source.videoWidth,this.height=this.source.videoHeight):(this.width=this.source.width,this.height=this.source.height),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.source)):"data"===this.sourceType&&this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.width,this.height,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.source),this.trigger("loaded",this))}},{key:"setFiltering",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.valid){this.powerOf2=q(this.width)&&q(this.height),this.filtering=e.filtering||"linear";var t=this.gl;this.bind(),this.powerOf2?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,e.TEXTURE_WRAP_S||t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,e.TEXTURE_WRAP_T||t.REPEAT),"mipmap"===this.filtering?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.generateMipmap(t.TEXTURE_2D)):"linear"===this.filtering?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)):"nearest"===this.filtering&&(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST))):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),"mipmap"===this.filtering&&(this.filtering="linear"),"nearest"===this.filtering?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)))}}}]),e}();Y.getMaxTextureSize=function(e){return e.getParameter(e.MAX_TEXTURE_SIZE)},Y.activeUnit=-1;var Z=function(){function e(t,i,n){var r=this;K(this,e),z(this),i=i||{},n=n||{},!t.hasAttribute("data-fullscreen")||"1"!=t.getAttribute("data-fullscreen")&&"true"!=t.getAttribute("data-fullscreen")?(this.width=t.clientWidth,this.height=t.clientHeight):(this.width=window.innerWidth,this.height=window.innerHeight,t.width=window.innerWidth,t.height=window.innerHeight),this.canvas=t,this.gl=void 0,this.deps={},this.program=void 0,this.textures={},this.buffers={},this.uniforms={},this.vbo={},this.isValid=!1,this.animationFrameRequest=void 0,this.BUFFER_COUNT=0,this.vertexString=i.vertexString||"\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nattribute vec2 a_position;\nattribute vec2 a_texcoord;\n\nvarying vec2 v_texcoord;\n\nvoid main() {\n    gl_Position = vec4(a_position, 0.0, 1.0);\n    v_texcoord = a_texcoord;\n}\n",this.fragmentString=i.fragmentString||"\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nvarying vec2 v_texcoord;\n\nvoid main(){\n    gl_FragColor = vec4(0.0);\n}\n";var s=function(e,t,i){function n(t,n){var r,s;"function"==typeof i?i(t):(r=n,(s=e.parentNode)&&(s.innerHTML='\n<table style="background-color: #8CE; width: 100%; height: 100%;"><tr>\n<td align="center">\n<div style="display: table-cell; vertical-align: middle;">\n<div style="">'+r+"</div>\n</div>\n</td></tr></table>\n"))}if(!window.WebGLRenderingContext)return n(G,H),null;var r=function(e,t){for(var i=["webgl","experimental-webgl"],n=null,r=0;r<i.length;++r)try{n=e.getContext(i[r],t)}catch(e){if(n)break}return n}(e,t);return r?r.getExtension("OES_standard_derivatives"):n(W,B),r}(t,i,n.onError);if(s){if(this.gl=s,this.timeLoad=this.timePrev=performance.now(),this.timeDelta=0,this.forceRender=!0,this.paused=!1,this.realToCSSPixels=window.devicePixelRatio||1,t.style.backgroundColor=i.backgroundColor||"rgba(1,1,1,0)",t.hasAttribute("data-fragment"))this.fragmentString=t.getAttribute("data-fragment");else if(t.hasAttribute("data-fragment-url")){var o=t.getAttribute("data-fragment-url");I().get(o,(function(e,t,i){r.load(i,r.vertexString)}))}if(t.hasAttribute("data-vertex"))this.vertexString=t.getAttribute("data-vertex");else if(t.hasAttribute("data-vertex-url")){var a=t.getAttribute("data-vertex-url");I().get(a,(function(e,t,i){r.load(r.fragmentString,i)}))}if(this.load(),this.program){var l=s.getAttribLocation(this.program,"a_texcoord");this.vbo.texCoords=s.createBuffer(),this.gl.bindBuffer(s.ARRAY_BUFFER,this.vbo.texCoords),this.gl.bufferData(s.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),s.STATIC_DRAW),this.gl.enableVertexAttribArray(l),this.gl.vertexAttribPointer(l,2,s.FLOAT,!1,0,0);var h=s.getAttribLocation(this.program,"a_position");if(this.vbo.vertices=s.createBuffer(),this.gl.bindBuffer(s.ARRAY_BUFFER,this.vbo.vertices),this.gl.bufferData(s.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),s.STATIC_DRAW),this.gl.enableVertexAttribArray(h),this.gl.vertexAttribPointer(h,2,s.FLOAT,!1,0,0),t.hasAttribute("data-textures")){var c=t.getAttribute("data-textures").split(",");for(var u in c)this.setUniform("u_tex"+u,c[u])}var d={x:0,y:0};document.addEventListener("mousemove",(function(e){d.x=e.clientX||e.pageX,d.y=e.clientY||e.pageY}),!1);var p=this;return this.setMouse({x:0,y:0}),function e(){p.nMouse>1&&p.setMouse(d),p.resize()&&(p.forceRender=!0),p.render(),p.animationFrameRequest=window.requestAnimationFrame(e)}(),this}}}return F(e,[{key:"destroy",value:function(){for(var e in cancelAnimationFrame(this.animationFrameRequest),this.animated=!1,this.isValid=!1,this.textures)e.destroy&&e.destroy();for(var t in this.textures={},this.attribs)this.gl.deleteBuffer(this.attribs[t]);for(var i in this.gl.useProgram(null),this.gl.deleteProgram(this.program),this.buffers){var n=this.buffers[i];this.gl.deleteProgram(n.program)}this.program=null,this.gl=null}},{key:"load",value:function(e,t){var i=this;t&&(this.vertexString=t),e&&(this.fragmentString=e);var n=this.fragmentString.split(/\r?\n/);if(this.fragmentString="#define PLATFORM_WEBGL\n#line 0\n",n.forEach((function(e,t){var n=e.trim();if(n.startsWith('#include "lygia')){var r=n.substring(15).replace(/\'|\"|\;|\s/g,"");if(r.endsWith("glsl")){if(void 0===i.deps[r]){var s="https://lygia.xyz"+r;i.deps[r]=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(),200==t.status?t.responseText:""}(s)}i.fragmentString+=i.deps[r]+"\n#line "+(t+1)+"\n"}}else i.fragmentString+=e+"\n"})),this.animated=!1,this.nDelta=(this.fragmentString.match(/u_delta/g)||[]).length,this.nTime=(this.fragmentString.match(/u_time/g)||[]).length,this.nDate=(this.fragmentString.match(/u_date/g)||[]).length,this.nMouse=(this.fragmentString.match(/u_mouse/g)||[]).length,this.animated=this.nDate>1||this.nTime>1||this.nMouse>1,this.fragmentString.search(/sampler2D/g))for(var r=this.fragmentString.split("\n"),s=0;s<r.length;s++){var o=r[s].match(/uniform\s*sampler2D\s*([\w]*);\s*\/\/\s*([\w|\:\/\/|\.|\-|\_]*)/i);if(o){var a=o[2].split(".").pop().toLowerCase();o[1]&&o[2]&&("jpg"===a||"jpeg"===a||"png"===a||"ogv"===a||"webm"===a||"mp4"===a)&&this.setUniform(o[1],o[2])}if(r[s].match(/\s*void\s*main\s*/g))break}var l=$(this,this.vertexString,this.gl.VERTEX_SHADER),h=$(this,this.fragmentString,this.gl.FRAGMENT_SHADER);h?this.isValid=!0:(h=$(this,"void main(){\n\tgl_FragColor = vec4(1.0);\n}",this.gl.FRAGMENT_SHADER),this.isValid=!1);var c=V(this,[l,h]);this.gl.useProgram(c),this.gl.deleteShader(l),this.gl.deleteShader(h),this.program=c,this.change=!0,this.BUFFER_COUNT=0;var u=this.getBuffers(this.fragmentString);Object.keys(u).length&&this.loadPrograms(u),this.buffers=u,this.texureIndex=this.BUFFER_COUNT,this.trigger("load",{}),this.forceRender=!0,this.render()}},{key:"test",value:function(e,t,i){var n=this.vertexString,r=this.fragmentString,s=this.paused,o=this.gl.getExtension("EXT_disjoint_timer_query"),a=o.createQueryEXT(),l=this.isValid;(t||i)&&(this.load(t,i),l=this.isValid,this.forceRender=!0,this.render()),this.paused=!0,o.beginQueryEXT(o.TIME_ELAPSED_EXT,a),this.forceRender=!0,this.render(),o.endQueryEXT(o.TIME_ELAPSED_EXT);var h=this;!function c(){h.forceRender=!0,h.render();var u=o.getQueryObjectEXT(a,o.QUERY_RESULT_AVAILABLE_EXT),d=h.gl.getParameter(o.GPU_DISJOINT_EXT);if(u&&!d){var p={wasValid:l,frag:t||h.fragmentString,vert:i||h.vertexString,timeElapsedMs:o.getQueryObjectEXT(a,o.QUERY_RESULT_EXT)/1e6};h.paused=s,(t||i)&&h.load(r,n),e(p)}else window.requestAnimationFrame(c)}()}},{key:"loadTexture",value:function(e,t,i){var n=this;i||(i={}),"string"==typeof t?i.url=t:"object"===(void 0===t?"undefined":O(t))&&t.data&&t.width&&t.height?(i.data=t.data,i.width=t.width,i.height=t.height):"object"===(void 0===t?"undefined":O(t))&&(i.element=t),this.textures[e]?this.textures[e]&&(this.textures[e].load(i),this.textures[e].on("loaded",(function(e){n.forceRender=!0}))):(this.textures[e]=new Y(this.gl,e,i),this.textures[e].on("loaded",(function(e){n.forceRender=!0})))}},{key:"refreshUniforms",value:function(){this.uniforms={}}},{key:"setUniform",value:function(e){for(var t={},i=arguments.length,n=Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];t[e]=n,this.setUniforms(t)}},{key:"setUniforms",value:function(e){var t=j(e);for(var i in t)"sampler2D"===t[i].type?this.loadTexture(t[i].name,t[i].value[0]):this.uniform(t[i].method,t[i].type,t[i].name,t[i].value);this.forceRender=!0}},{key:"setMouse",value:function(e){var t=this.canvas.getBoundingClientRect();if(e&&e.x&&e.x>=t.left&&e.x<=t.right&&e.y&&e.y>=t.top&&e.y<=t.bottom){var i=(e.x-t.left)*this.realToCSSPixels,n=this.canvas.height-(e.y-t.top)*this.realToCSSPixels;this.uniform("2f","vec2","u_mouse",i,n)}}},{key:"uniform",value:function(e,t,i){this.uniforms[i]=this.uniforms[i]||{};for(var n=this.uniforms[i],r=arguments.length,s=Array(r>3?r-3:0),o=3;o<r;o++)s[o-3]=arguments[o];var a,l;if(l=s,(a=n.value)&&l&&a.toString()!==l.toString()||this.change||!n.location||!n.value)for(var h in n.name=i,n.type=t,n.value=s,n.method="uniform"+e,this.gl.useProgram(this.program),n.location=this.gl.getUniformLocation(this.program,i),this.gl[n.method].apply(this.gl,[n.location].concat(n.value)),this.buffers){var c=this.buffers[h];this.gl.useProgram(c.program);var u=this.gl.getUniformLocation(c.program,i);this.gl[n.method].apply(this.gl,[u].concat(n.value))}}},{key:"uniformTexture",value:function(e,t,i){if(void 0===this.textures[e])this.loadTexture(e,t,i);else{for(var n in this.uniform("1i","sampler2D",e,this.texureIndex),this.buffers){var r=this.buffers[n];this.gl.useProgram(r.program),this.gl.activeTexture(this.gl.TEXTURE0+this.texureIndex),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textures[e].texture)}this.gl.useProgram(this.program),this.gl.activeTexture(this.gl.TEXTURE0+this.texureIndex),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textures[e].texture),this.uniform("2f","vec2",e+"Resolution",this.textures[e].width,this.textures[e].height)}}},{key:"resize",value:function(){if(this.width!==this.canvas.clientWidth||this.height!==this.canvas.clientHeight){this.realToCSSPixels=window.devicePixelRatio||1;var e=Math.floor(this.gl.canvas.clientWidth*this.realToCSSPixels),t=Math.floor(this.gl.canvas.clientHeight*this.realToCSSPixels);return this.gl.canvas.width===e&&this.gl.canvas.height===t||(this.gl.canvas.width=e,this.gl.canvas.height=t,this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height)),this.width=this.canvas.clientWidth,this.height=this.canvas.clientHeight,this.resizeSwappableBuffers(),!0}return!1}},{key:"render",value:function(){var e;if(this.visible=(e=this.canvas.getBoundingClientRect()).top+e.height>0&&e.top<(window.innerHeight||document.documentElement.clientHeight),this.forceRender||this.change||this.animated&&this.visible&&!this.paused){var t=new Date,i=performance.now();for(var n in this.timeDelta=(i-this.timePrev)/1e3,this.timePrev=i,this.nDelta>1&&this.uniform("1f","float","u_delta",this.timeDelta),this.nTime>1&&this.uniform("1f","float","u_time",(i-this.timeLoad)/1e3),this.nDate&&this.uniform("4f","float","u_date",t.getFullYear(),t.getMonth(),t.getDate(),3600*t.getHours()+60*t.getMinutes()+t.getSeconds()+.001*t.getMilliseconds()),this.uniform("2f","vec2","u_resolution",this.canvas.width,this.canvas.height),this.buffers){var r=this.buffers[n];this.uniform("1i","sampler2D",r.name,r.bundle.input.index)}for(var s in this.texureIndex=this.BUFFER_COUNT,this.textures)this.uniformTexture(s),this.texureIndex++;this.renderPrograms(),this.trigger("render",{}),this.change=!1,this.forceRender=!1}}},{key:"pause",value:function(){this.paused=!0}},{key:"play",value:function(){this.paused=!1}},{key:"renderPrograms",value:function(){var e=this.gl,t=e.canvas.width,i=e.canvas.height;for(var n in e.viewport(0,0,t,i),this.buffers){var r=this.buffers[n];r.bundle.render(t,i,r.program,r.name),e.bindFramebuffer(e.FRAMEBUFFER,null)}e.useProgram(this.program),e.drawArrays(e.TRIANGLES,0,6)}},{key:"getBuffers",value:function(e){var t={};return e&&e.replace(/(?:^\s*)((?:#if|#elif)(?:\s*)(defined\s*\(\s*BUFFER_)(\d+)(?:\s*\))|(?:#ifdef)(?:\s*BUFFER_)(\d+)(?:\s*))/gm,(function(){var i=arguments[3]||arguments[4];t["u_buffer"+i]={fragment:"#define BUFFER_"+i+"\n"+e}})),t}},{key:"loadPrograms",value:function(e){var t=this,i=this.gl,n=$(t,t.vertexString,i.VERTEX_SHADER);for(var r in e){var s=e[r],o=$(t,s.fragment,i.FRAGMENT_SHADER,1);o?t.isValid=!0:(o=$(t,"void main(){\n\tgl_FragColor = vec4(1.0);\n}",i.FRAGMENT_SHADER),t.isValid=!1);var a=V(t,[n,o]);s.name=r,s.program=a,s.bundle=t.createSwappableBuffer(t.canvas.width,t.canvas.height,a),i.deleteShader(o)}i.deleteShader(n)}},{key:"createSwappableBuffer",value:function(e,t,i){var n=this.createBuffer(e,t,i),r=this.createBuffer(e,t,i),s=this.gl;return{input:n,output:r,swap:function(){var e=n;n=r,r=e,this.input=n,this.output=r},render:function(e,t,i,n){s.useProgram(i),s.viewport(0,0,e,t),s.bindFramebuffer(s.FRAMEBUFFER,this.input.buffer),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,this.output.texture,0),s.drawArrays(s.TRIANGLES,0,6),this.swap()},resize:function(e,t,i,n){s.useProgram(i),s.viewport(0,0,e,t),this.input.resize(e,t),this.output.resize(e,t)}}}},{key:"createBuffer",value:function(e,t,i){var n=this.gl,r=this.BUFFER_COUNT;this.BUFFER_COUNT+=2,n.getExtension("OES_texture_float");var s=n.createTexture();n.activeTexture(n.TEXTURE0+r),n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e,t,0,n.RGBA,n.FLOAT,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);var o=n.createFramebuffer();return{index:r,texture:s,buffer:o,W:e,H:t,resize:function(e,t){n.bindFramebuffer(n.FRAMEBUFFER,o);var i=Math.min(e,this.W),a=Math.min(t,this.H),l=new Float32Array(i*a*4);n.readPixels(0,0,i,a,n.RGBA,n.FLOAT,l),n.bindFramebuffer(n.FRAMEBUFFER,null);var h=r+1,c=n.createTexture();n.activeTexture(n.TEXTURE0+h),n.bindTexture(n.TEXTURE_2D,c),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e,t,0,n.RGBA,n.FLOAT,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,i,a,n.RGBA,n.FLOAT,l);var u=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(s),n.activeTexture(n.TEXTURE0+r),n.bindTexture(n.TEXTURE_2D,c),r=this.index=r,s=this.texture=c,o=this.buffer=u,this.W=e,this.H=t}}}},{key:"resizeSwappableBuffers",value:function(){var e=this.gl,t=e.canvas.width,i=e.canvas.height;for(var n in e.viewport(0,0,t,i),this.buffers){var r=this.buffers[n];r.bundle.resize(t,i,r.program,r.name)}e.useProgram(this.program)}},{key:"version",value:function(){return"0.1.7"}}]),e}();window.addEventListener("load",(function(){!function(){var e=document.getElementsByClassName("glslCanvas");if(e.length>0){window.glslCanvases=[];for(var t=0;t<e.length;t++){var i=new Z(e[t]);i.isValid&&window.glslCanvases.push(i)}}}()}));const J=Z;class Q extends k{onInit(){const e=this.onInitFragment();this.glslCanvas=new J(this.canvas,{fragmentString:e})}onRender(){this.glslCanvas.setUniform("u_array",...this.strip._floatRawData)}}customElements.define("app-slide-up-strip-renderer",class extends Q{onInitFragment(){return`\n      #ifdef GL_ES\n        precision mediump float;\n      #endif\n      \n      const float FACTOR = ${this.factor.toPrecision(5)};\n      const int STRIP_LENGTH = ${this.strip.length};\n      const int COLOR_PER_PIXEL = ${this.strip.getColorPerPixel()};\n      uniform vec2 u_resolution;\n      uniform vec2 u_mouse;\n      uniform float u_time;\n      uniform sampler2D u_buffer0;\n      \n      uniform float u_array[STRIP_LENGTH * COLOR_PER_PIXEL];\n      \n      \n      void main() {\n        vec2 uv = gl_FragCoord.xy / u_resolution.xy;\n      \n        #if defined( BUFFER_0 )\n          // Buffer\n          vec3 diff = vec3( vec2(1.0) / u_resolution.xy, 0.0);\n          vec2 mouse_uv = u_mouse.xy / u_resolution.xy;\n          float mouse_pointer = smoothstep(100.0, 1.0, length((mouse_uv - uv) * u_resolution) );\n      \n          vec4 center = texture2D(u_buffer0, uv);\n      \n          if (u_time < .1) {\n            gl_FragColor = vec4(vec3(0.), 1.);\n      \n          } else {\n            if (gl_FragCoord.y < 1.) {\n              int colorIndex = int(floor(uv.x * float(STRIP_LENGTH)));\n              vec3 finalColor;\n  \n              for (int i = 0; i < STRIP_LENGTH; i++) {\n                if (i == colorIndex) {\n                  finalColor = vec3(\n                  (u_array[i*COLOR_PER_PIXEL]     + u_array[i*COLOR_PER_PIXEL + 3] * .5) * FACTOR,\n                  (u_array[i*COLOR_PER_PIXEL + 1] + u_array[i*COLOR_PER_PIXEL + 3] * .5) * FACTOR,\n                  (u_array[i*COLOR_PER_PIXEL + 2] + u_array[i*COLOR_PER_PIXEL + 3] * .35) * FACTOR\n                  );\n                }\n              }\n              gl_FragColor = vec4(finalColor, 1.0);\n            } else {\n              vec3 lastCenterValue = center.rgb;\n              vec3 lastTopValue = texture2D(u_buffer0, uv - diff.zy).rgb;\n              vec3 lastLeftValue = texture2D(u_buffer0, uv - diff.xz).rgb;\n              vec3 lastRightValue = texture2D(u_buffer0, uv + diff.xz).rgb;\n              vec3 lastBottomValue = texture2D(u_buffer0, uv + diff.zy).rgb;\n  \n              vec3 newValue = (\n                  0. * lastCenterValue\n                + 1.0 * lastTopValue\n                + .02 * lastLeftValue\n                + .02 * lastRightValue\n                + .0 * lastBottomValue)\n                / 1.0;\n              //newValue += .1 * mouse_pointer; // mouse\n              newValue *= 0.96; // damping\n              //newValue *= step(0.1, u_time); // hacky way of clearing the buffer\n              //newValue = 0.5 + newValue * 0.5;\n              newValue = clamp(newValue, 0., 1.);\n              gl_FragColor = vec4(newValue, 1.);\n            }\n          }\n      \n        #else\n          // Main Buffer\n          gl_FragColor = texture2D(u_buffer0, uv);\n        #endif\n      }\n    `}});class ee extends HTMLElement{constructor(){super(...arguments),this._elements=[],this.factor=8}get strip(){return this._strip}set strip(e){this._strip=e,this.init()}connectedCallback(){const e=document.createElement("style");e.innerHTML=`\n      ${this.tagName} {\n        display: flex;\n      }\n\n      ${this.tagName} > * {\n        aspect-ratio: 1;\n        -webkit-appearance: none;\n        -moz-appearance: none;\n        appearance: none;\n        background: none;\n        border: 0;\n        cursor: pointer;\n        padding: 0;\n        height: auto;\n        min-width: 0;\n        overflow: hidden;\n      }\n\n      ${this.tagName} > ::-webkit-color-swatch-wrapper {\n        padding: 0;\n      }\n\n      ${this.tagName} > ::-webkit-color-swatch{\n        border: 0;\n        border-radius: 0;\n      }\n\n      ${this.tagName} > ::-moz-color-swatch,\n      ${this.tagName} > ::-moz-focus-inner{\n        border: 0;\n      }\n\n      ${this.tagName} > ::-moz-focus-inner{\n        padding: 0;\n      }\n    `,this.prepend(e)}init(){this._strip.forEach((()=>{const e=document.createElement("input");e.setAttribute("type","color"),e.addEventListener("input",(()=>{ee.hasFixedColor(e)&&"#000000"===e.value?ee.disableFixedColor(e):ee.enableFixedColor(e)})),this.appendChild(e),this._elements.push(e)}))}update(){this._strip.forEach((e=>{const t=this._elements[e],i=this.strip.get(e),n=ee.fromNormalToHexa((255*i.r+255*i.w*.5)*this.factor),r=ee.fromNormalToHexa((255*i.g+255*i.w*.5)*this.factor),s=ee.fromNormalToHexa((255*i.b+255*i.w*.35)*this.factor);if(ee.hasFixedColor(t)){const n=Math.min(1,i.r+ee.fromHexaToNormal(t.value.substring(1,2))),r=Math.min(1,i.g+ee.fromHexaToNormal(t.value.substring(3,4))),s=Math.min(1,i.b+ee.fromHexaToNormal(t.value.substring(5,6)));this._strip.set(e,n,r,s,i.w)}else t.value=`#${n}${r}${s}`}))}static hasFixedColor(e){return"fixedColor"in e.dataset}static enableFixedColor(e){e.dataset.fixedColor=""}static disableFixedColor(e){delete e.dataset.fixedColor}static fromHexaToNormal(e){return parseInt(e,16)/255}static fromNormalToHexa(e){return Math.floor(Math.min(255,e)).toString(16).padStart(2,"0")}}ee.tagName="app-strip",customElements.define(ee.tagName,ee);class te extends EventTarget{constructor(e,t){super(),this.host=e,this.modeEcoDelay=60,this._lastSyncTime=0,this._isEcoMode=!1,this._isClosed=!0,this._isDisconnectionRequested=!1,this.onConnected=t,this.connect()}connect(){this._isDisconnectionRequested=!1,this.socket=new WebSocket(`ws://${this.host}`),this.socket.onopen=()=>{console.log("RemoteStrip -> Websocket: Connection established"),console.time("RemoteStrip -> Websocket: connected"),this.dispatchEvent(new Event(te.ON_CONNECTED)),this._isClosed=!1},this.socket.onmessage=e=>{console.log("RemoteStrip -> Websocket: Data reception: "+e.data);try{const t=JSON.parse(e.data);t.stripLength&&t.colorPerPixel&&t.fpsMax&&(this.fpsMax=t.fpsMax,this.strip=new b(t.stripLength,t.colorPerPixel),"function"==typeof this.onConnected&&this.onConnected(this.strip,(()=>this.sync())),this._modeEcoTimeInterval=setInterval((()=>this._isEcoMode=!0),1e3*this.modeEcoDelay))}catch(e){console.log(e)}},this.socket.onclose=()=>{console.log("RemoteStrip -> Websocket: Connection closed"),console.timeEnd("RemoteStrip -> Websocket: connected"),clearInterval(this._modeEcoTimeInterval),this.dispatchEvent(new Event(te.ON_DISCONNECTED)),this._isClosed=!0,this._isDisconnectionRequested||this.connect()},this.socket.onerror=e=>{console.error("RemoteStrip -> Websocket: Socket encountered error: ",e.message," Closing socket"),this.socket.close()}}disconnect(){this.socket&&(this._isDisconnectionRequested=!0,this.socket.close())}sync(){const e=performance.now();e>this._lastSyncTime+1e3/this.fpsMax&&!this._isClosed&&this.socket&&this.strip&&(!this._isEcoMode||this._isEcoMode&&this.strip.isDirty)&&(this._lastSyncTime=e,this._isEcoMode=!1,this.strip.isDirty=!1,this.socket.send(this.strip.getIntRawData()))}}te.ON_CONNECTED="connected",te.ON_DISCONNECTED="disconnected";class ie extends EventTarget{constructor(){super(...arguments),this._onMidiSuccess=e=>{console.log("MidiAccess -> API: OK"),e.addEventListener("statechange",(t=>{const i=t.port;switch(i.state){case"connected":switch(i.connection){case"closed":"input"===i.type?this._connectInputPort(e):"output"===i.type&&this._connectOutputPort(e);break;case"open":console.log(`MidiAccess -> Device: ${i.type} port connected`);const t={detail:{port:i}};this.dispatchEvent(new CustomEvent(ie.ON_PORT_CONNECTED,t))}break;case"disconnected":console.log(`MidiAccess -> Device: ${i.type} port disconnected`);const t={detail:{port:i}};this.dispatchEvent(new CustomEvent(ie.ON_PORT_DISCONNECTED,t))}})),this._connectInputPort(e),this._connectOutputPort(e)},this._onMidiFailure=e=>{console.log("MidiAccess: No access to MIDI devices or your browser doesn't support WebMIDI API. Please use WebMIDIAPIShim "+e)},this._onMidiMessage=e=>{let t=e.data,i=240&t[0],n=t[1],r=t[2];switch(i){case 144:r>0?this.triggerNoteOn(n,r):this.triggerNoteOff(n);break;case 128:this.triggerNoteOff(n);break;case 176:switch(n){case 64:this.triggerSustain(r);break;case 67:this.triggerSoftPedal(r)}}}}requestMidiAccess(){navigator.requestMIDIAccess?navigator.requestMIDIAccess({sysex:!1}).then(this._onMidiSuccess).catch(this._onMidiFailure):alert("No MIDI support in your browser. Please try with Google Chrome.")}_connectInputPort(e){const t=e.inputs.values();for(let e=t.next();e&&!e.done;e=t.next())e.value.onmidimessage=this._onMidiMessage}_connectOutputPort(e){const t=e.outputs.values();for(let e=t.next();e&&!e.done;e=t.next())this.output=e.value}triggerNoteOn(e,t){const i={detail:{note:e,velocity:t}};this.dispatchEvent(new CustomEvent(ie.ON_NOTE_ON,i))}triggerNoteOff(e){const t={detail:{note:e}};this.dispatchEvent(new CustomEvent(ie.ON_NOTE_OFF,t))}triggerSustain(e){const t={detail:{level:e}};this.dispatchEvent(new CustomEvent(ie.ON_SUSTAIN,t))}triggerSoftPedal(e){const t={detail:{level:e}};this.dispatchEvent(new CustomEvent(ie.ON_SOFT_PEDAL,t))}sendNoteOn(e,t){this.output&&this.output.send([144,e,t])}sendNoteOff(e){this.output&&(this.output.send([144,e,0]),this.output.send([128,e,0]))}}ie.ON_PORT_CONNECTED="port_connected",ie.ON_PORT_DISCONNECTED="port_disconnected",ie.ON_NOTE_ON="note_on",ie.ON_NOTE_OFF="note_off",ie.ON_SUSTAIN="sustain",ie.ON_SOFT_PEDAL="softPedal";class ne extends HTMLElement{constructor(){super(...arguments),this.framePerSecond=60,this.frameInterval=1e3/this.framePerSecond,this.notes=[],this.elementRefs={stripElement:new S,viewportStripRenderer:new S,pianoKeyboard:new S}}connectedCallback(){this.viewInit(),this.init()}viewInit(){this.innerHTML=`      \n      <div class="grow relative">\n        <app-auto-hide data-delay="1000" class="app_overlay">\n          <app-config-panel></app-config-panel>\n        </app-auto-hide>\n        \n        <div ${this.elementRefs.viewportStripRenderer}></div>\n      </div>\n      \n      <app-strip ${this.elementRefs.stripElement}></app-strip>\n      \n      <app-piano-keyboard \n          ${this.elementRefs.pianoKeyboard}\n          class="shrink-0"\n          data-lowest-key="${T.pianoKeyboard.lowestKey}"\n          data-highest-key="${T.pianoKeyboard.highestKey}">\n      </app-piano-keyboard>\n    `}init(){this.initStrip(),this.initNoteState(),this.initRemoteStrip(),this.initStripElement(),this.initMidiAccess(),x.strip.behavior.onChange((()=>this.initStripBehavior())),x.viewportRenderer.onChange((()=>this.initViewportRenderer())),this.startMainLoop()}onTick(){this.stripBehavior.tick(),this.remoteStrip&&this.syncRemoteStrip&&(this.strip.copyTo(this.remoteStrip,this.remoteStripOffset),this.syncRemoteStrip()),this.elementRefs.stripElement.element.update(),this.viewportRendererElement.render()}initStrip(){this.strip=new b(T.pianoKeyboard.highestKey-T.pianoKeyboard.lowestKey+1)}initRemoteStrip(){this.remoteStripOffset=T.remoteStrip.startPointNote-T.pianoKeyboard.lowestKey,x.strip.remoteHost.onChange((()=>this.connectToRemoteStrip()))}connectToRemoteStrip(){T.remoteStrip.host&&(this.remoteStripConnexion&&this.remoteStripConnexion.disconnect(),this.remoteStripConnexion=new te(T.remoteStrip.host,((e,t)=>{this.remoteStrip=e,this.syncRemoteStrip=t})),this.initRemoteStripEventListener())}initRemoteStripEventListener(){this.remoteStripConnexion.addEventListener(te.ON_CONNECTED,(()=>{x.strip.isRemoteConnected.value=!0})),this.remoteStripConnexion.addEventListener(te.ON_DISCONNECTED,(()=>{x.strip.isRemoteConnected.value=!1}))}initNoteState(){this.strip.forEach((e=>{this.notes[e]={pressed:!1,sustained:!1,velocity:0}}))}initStripBehavior(){const e=T.stripBehavior.list[x.strip.behavior.value];this.stripBehavior=new e(this.strip,this.notes)}initStripElement(){const e=this.elementRefs.stripElement.element;e.style.marginLeft=this.elementRefs.pianoKeyboard.element.leftMargin+"%",e.style.marginRight=this.elementRefs.pianoKeyboard.element.rightMargin+"%",e.factor=8,e.strip=this.strip}initViewportRenderer(){const e=T.viewportRenderer.list[x.viewportRenderer.value],t=document.createElement(e);t.style.position="absolute",t.style.inset="0",t.style.marginLeft=this.elementRefs.pianoKeyboard.element.leftMargin+"%",t.style.marginRight=this.elementRefs.pianoKeyboard.element.rightMargin+"%",this.viewportRendererElement=t,this.elementRefs.viewportStripRenderer.element.innerHTML="",this.elementRefs.viewportStripRenderer.element.appendChild(t),t.factor=4,t.strip=this.strip}initMidiAccess(){const e=new ie;e.addEventListener(ie.ON_PORT_CONNECTED,(e=>{const t=e.detail.port.type,i=e.detail.port.name;x.midi.ports[t].value.push(i),x.midi.ports[t].notifyChange()})),e.addEventListener(ie.ON_PORT_DISCONNECTED,(e=>{const t=e.detail.port.type,i=e.detail.port.name,n=x.midi.ports[t].value.indexOf(i);n>-1&&(x.midi.ports[t].value.splice(n,1),x.midi.ports[t].notifyChange())})),e.addEventListener(ie.ON_NOTE_ON,(e=>{this.elementRefs.pianoKeyboard.element.pressKey(e.detail.note),this.notes[e.detail.note-T.pianoKeyboard.lowestKey].pressed=!0,this.notes[e.detail.note-T.pianoKeyboard.lowestKey].sustained=this.elementRefs.pianoKeyboard.element.isSustained(),this.notes[e.detail.note-T.pianoKeyboard.lowestKey].velocity=e.detail.velocity/128})),e.addEventListener(ie.ON_NOTE_OFF,(e=>{this.elementRefs.pianoKeyboard.element.releaseKey(e.detail.note),this.notes[e.detail.note-T.pianoKeyboard.lowestKey].pressed=!1})),e.addEventListener(ie.ON_SUSTAIN,(e=>{this.elementRefs.pianoKeyboard.element.setSustain(e.detail.level),this.elementRefs.pianoKeyboard.element.isSustained()?this.notes.forEach((e=>e.sustained=!(!e.pressed&&!e.sustained))):this.notes.forEach((e=>e.sustained=!1))})),e.requestMidiAccess(),this.elementRefs.pianoKeyboard.element.addEventListener(A.ON_KEY_PRESSED,(t=>{e.triggerNoteOn(t.detail.note,t.detail.velocity),e.sendNoteOn(t.detail.note,t.detail.velocity)})),this.elementRefs.pianoKeyboard.element.addEventListener(A.ON_KEY_RELEASED,(t=>{e.triggerNoteOff(t.detail.note),e.sendNoteOff(t.detail.note)}))}startMainLoop(){this.onTick(),setTimeout((()=>this.startMainLoop()),this.frameInterval)}}customElements.define("app-root",ne)})()})();</script></body></html>